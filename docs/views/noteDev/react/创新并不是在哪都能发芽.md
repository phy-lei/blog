---
title: åˆ›æ–°å¹¶ä¸æ˜¯åœ¨å“ªéƒ½èƒ½å‘èŠ½
date: 2023-12-06
tags:
  - react
categories:
  - react
permalink: /20231206
---

æœ€è¿‘åœ¨å†™ä¸€ä¸ªéœ€æ±‚çš„æ—¶å€™ï¼Œè¦å®ç°ä¸€ä¸ªå¸é¡¶åŠŸèƒ½æŠ˜å é¢æ¿ç»„ä»¶ï¼Œçœ‹èµ·æ¥å¹¶ä¸æ˜¯å¾ˆéš¾ï¼Œä½†æ˜¯å¦‚ä½•å»è®¾è®¡ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘è§‰å¾—æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ä»¶äº‹æƒ…ï¼Œå½“çœŸæ­£å®Œæˆçš„æ—¶å€™ï¼Œæ¥åˆ°ä»£ç è¯„å®¡é˜¶æ®µï¼Œç»„é•¿å´è¡¨ç¤ºè¿™æ˜¯æ²¡æœ‰æ„ä¹‰çš„åˆ›æ–°ï¼Œè®©æˆ‘æ”¹ç”¨æœ€ç®€å•çš„åšæ³•å»å†™å°±å¥½ï¼ŒåŸæ¥åˆ›æ–°å¹¶ä¸æ˜¯åœ¨å“ªéƒ½èƒ½å‘èŠ½ã€‚

## æˆ‘çš„è®¾è®¡

ä¸€èˆ¬æœ€å¥½çš„ä¸€ä¸ªä»£ç å†™æ³•ï¼Œå»å‚è€ƒç»„ä»¶åº“ï¼Œè‚¯å®šæ²¡æœ‰é”™ã€‚äºæ˜¯æ‰“å¼€ antdã€arco çœ‹çœ‹ä»–ä»¬çš„å®ç°ï¼Œantd å†™å¾—å¤ªå¤æ‚ï¼Œæ‰€ä»¥ä¸»è¦å‚è€ƒ arco çš„æŠ˜å ç»„ä»¶ï¼Œæˆ‘å‘ç°ä»–çš„ç”¨æ³•æ˜¯ä½¿ç”¨ headless çš„å†™æ³•ï¼Œä¹‹å‰æˆ‘ä¹Ÿçœ‹äº† chakra-ui çš„ç»„ä»¶åº“ï¼Œæˆ‘è§‰å¾—è¿™ç§å†™æ³•æŒºå¥½çš„ï¼Œå¹¶æ²¡æœ‰è€¦åˆåœ¨ä¸€èµ·ã€‚

```tsx
import { Collapse, Divider } from "@arco-design/web-react";
const CollapseItem = Collapse.Item;

const App = () => {
  return (
    <Collapse defaultActiveKey={["1", "2"]} style={{ maxWidth: 1180 }}>
      <CollapseItem header="Beijing Toutiao Technology Co., Ltd." name="1">
        Beijing Toutiao Technology Co., Ltd.
        <Divider style={{ margin: "8px 0" }} />
        Beijing Toutiao Technology Co., Ltd.
        <Divider style={{ margin: "8px 0" }} />
        Beijing Toutiao Technology Co., Ltd.
      </CollapseItem>

      <CollapseItem header="Introduce" name="2" disabled>
        ByteDance's core product, Toutiao ('Headlines'), is a content platform
        in China and around the world. Toutiao started out as a news
        recommendation engine and gradually evolved into a platform delivering
        content in various formats, such as texts, images, question-and-answer
        posts, microblogs, and videos.
      </CollapseItem>
    </Collapse>
  );
};
```

äºæ˜¯æˆ‘ä¹Ÿæƒ³ç€æŠŠæˆ‘çš„æŠ˜å ç»„ä»¶çš„ç”¨æ³•ä¹Ÿè®¾è®¡æˆè¿™æ ·ï¼ŒCollapse ç»„ä»¶å¯ä»¥ç»Ÿä¸€ç®¡ç† item çš„æŠ˜å çŠ¶æ€ï¼Œè¿™æ ·å°±ä¸ç”¨äº¤ç»™ç”¨æˆ·å»ä¹¦å†™æ›´å¤šçš„é€»è¾‘ï¼Œä½†æ˜¯ item ç»„ä»¶åˆå¯ä»¥é«˜åº¦è‡ªç”±åŒ–ï¼Œæ— è®ºæ˜¯ ui çš„æ ·å¼ï¼Œè¿˜æ˜¯çŠ¶æ€çš„ä¼ è¾“ã€‚

## æ»šåŠ¨å¸é¡¶

ä¹‹å‰å°±è®°å¾—æœ‰ä¸ª css å±æ€§èƒ½å¤Ÿå®ç°æ»šåŠ¨åˆ°è¯¥å…ƒç´ ä½ç½®æ—¶ï¼Œå°±ç»™äºˆå¸é¡¶ï¼Œsticky ç²˜æ€§å®šä½ï¼Œè¿™ä¸ªå¾ˆå¥½åšåˆ°ï¼Œç›®å‰è¿™ä¸ªå±æ€§çš„å…¼å®¹æ€§ä¹Ÿè¿˜å¯ä»¥ï¼Œæ‰€ä»¥å°±ä¸€æ—¦ç‚¹å‡»åï¼Œå°±æŠŠè¿™ä¸ª sticky åŠ ä¸Šå°±å¯ä»¥ã€‚ä¸è¿‡æ€ä¹ˆåšåˆ°æ»šåŠ¨åˆ°è¶…å‡ºè¿™ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä»–åˆä¸å¸é¡¶ï¼Œè¿™åˆ°åº•æ€ä¹ˆåšå‘¢ã€‚å…¶å®ï¼Œå¾ˆç®€å•ï¼Œåªè¦æˆ‘ä»¬æŠŠ html çš„å¸ƒå±€ç»“æ„æ”¹ä¸‹å°±å¥½

```html
<ul>
  <li class="sticky">sticky 1</li>
  <li>2</li>
  <li>3</li>
  <li>4</li>
</ul>
<ul>
  <li class="sticky">sticky 5</li>
  <li>6</li>
  <li>7</li>
  <li>8</li>
</ul>
<ul>
  <li class="sticky">sticky 9</li>
  <li>10</li>
  <li>11</li>
  <li>12</li>
</ul>
<ul>
  <li class="sticky">sticky 13</li>
  <li>14</li>
  <li>15</li>
  <li>16</li>
</ul>
```

å½“ä»–æ»šåŠ¨åˆ°å¯¹åº” ul ä¸‹çš„ li æ ‡ç­¾ stickyï¼Œè¶…è¿‡è¿™ä¸ª ul æ—¶å°±ä¼šåˆ°ç¬¬äºŒä¸ªå…ƒç´  stickyã€‚
<img :src="$withBase('/assets/20231206/1.gif')" alt="">

## collapse-sticky

å‡†å¤‡å·¥ä½œéƒ½å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥è®¾è®¡ä¸Šå±‚çˆ¶ç»„ä»¶ collapse-stickyï¼Œå‘ç°è¿™é‡Œæœ‰ç”¨åˆ° context çš„ä¸œè¥¿ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¦™çš„ç‚¹ï¼Œå› ä¸ºç›®å‰çš„è®¾è®¡ç”¨æ³•ï¼Œå¹¶ä¸èƒ½é€šè¿‡ props ä¸‹å‘æŠ˜å æ€çš„æ•°æ®åˆ° item ç»„ä»¶ï¼Œitem ç»„ä»¶æ˜¯åœ¨ä¸šåŠ¡å±‚é¢è¿›è¡Œå¼•å…¥çš„ï¼Œä»–å¹¶ä¸èƒ½æ‹¿åˆ° collapse-sticky çš„çŠ¶æ€ï¼Œå¹¶ä¸‹å‘åˆ° item ç»„ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯å¿…é¡»å¾—ç”¨ context äº†ï¼Œè€Œ arco çš„ context å†™çš„å¹¶ä¸ä¼˜é›…ï¼Œè¿™é‡Œï¼Œæˆ‘å€Ÿç”¨ chakra-ui çš„ context å°è£…ï¼Œä»–å†™çš„æŒºå¥½

```ts
import {
  createContext as createReactContext,
  useContext as useReactContext,
} from "react";

export interface CreateContextOptions<T> {
  strict?: boolean;
  hookName?: string;
  providerName?: string;
  errorMessage?: string;
  name?: string;
  defaultValue?: T;
}

export type CreateContextReturn<T> = [
  React.Provider<T>,
  () => T,
  React.Context<T>
];

function getErrorMessage(hook: string, provider: string) {
  return `${hook} returned \`undefined\`. Seems you forgot to wrap component within ${provider}`;
}

export function createContext<T>(options: CreateContextOptions<T> = {}) {
  const {
    name,
    strict = true,
    hookName = "useContext",
    providerName = "Provider",
    errorMessage,
    defaultValue,
  } = options;

  const Context = createReactContext<T | undefined>(defaultValue);

  Context.displayName = name;

  function useContext() {
    const context = useReactContext(Context);

    if (!context && strict) {
      const error = new Error(
        errorMessage ?? getErrorMessage(hookName, providerName)
      );
      error.name = "ContextError";
      Error.captureStackTrace?.(error, useContext);
      throw error;
    }

    return context;
  }

  return [Context.Provider, useContext, Context] as CreateContextReturn<T>;
}
```

ä½¿ç”¨

```ts
import { createContext } from "@/hooks/react-context";

interface UseCollapseStickyType {
  activeKeys: string | string[];
  onToggle: (key: string, e) => Promise<any>;
}

export const [CollapseStickyProvider, useCollapseStickyContext] =
  createContext<UseCollapseStickyType>({
    name: "CollapseStickyContext",
    hookName: "useCollapseStickyContext",
    providerName: "<CollapseSticky />",
  });
```

CollapseSticky ç»„ä»¶ï¼Œç»Ÿä¸€ç®¡ç† item ç»„ä»¶çš„çŠ¶æ€ï¼ŒåŠæä¾›ä¸€ä¸ªç‚¹å‡»çš„äº‹ä»¶çš„å›è°ƒä¼ è¾“

```tsx
import {
  createElement as h,
  PropsWithChildren,
  FC,
  useState,
  useLayoutEffect,
} from "react";
import { CollapseStickyProvider } from "./collapse-context";
import CollapseStickyItem from "./item";

interface Props {
  /**
   * å½“å‰é¢æ¿é€‰ä¸­å€¼
   */
  activeKey?: string | string[];
  /**
   * æŠ˜å é¢æ¿ç‚¹å‡»æ”¹å˜äº‹ä»¶
   */
  onChange?: (
    key: string,
    newActiveKeys: string[],
    e: React.MouseEvent<Element, MouseEvent>
  ) => Promise<any>;
}

const CollapseSticky: FC<PropsWithChildren<Props>> = ({
  children,
  activeKey,
  onChange,
}) => {
  const [activeKeys, setActiveKeys] = useState(activeKey || []);

  const onItemClick = async (
    key: string,
    e: React.MouseEvent<Element, MouseEvent>
  ) => {
    // æŠ˜å å­é¡¹ç‚¹å‡»çš„äº‹ä»¶é’©å­
  };

  return (
    <CollapseStickyProvider value={{ activeKeys, onToggle: onItemClick }}>
      {children || null}
    </CollapseStickyProvider>
  );
};

const CollapseComponent = CollapseSticky as typeof CollapseSticky & {
  Item: typeof CollapseStickyItem;
};

CollapseComponent.Item = CollapseStickyItem;

export default CollapseComponent;
```

### collapse-sticky-item

collapse-sticky-item ç»„ä»¶ï¼Œèƒ½å¤Ÿå…·å¤‡å±•å¼€æŠ˜å çš„åŠŸèƒ½ï¼Œå¹¶èƒ½ stickyï¼Œè€Œä¸”ä»–çš„çŠ¶æ€æ˜¯ç”± collapse-sticky çš„ context ä¸‹å‘ç®¡ç†çš„

```tsx
import {
  createElement as h,
  PropsWithChildren,
  FC,
  useState,
  useMemo,
  ReactNode,
} from "react";
import cs from "classnames";
import { isArray } from "@/utils/is";
import { useCollapseStickyContext } from "./collapse-context";
import css from "./style.less";

interface Props {
  /**
   * æŠ˜å é¢æ¿å¤´éƒ¨å†…å®¹ï¼Œå…è®¸è‡ªå®šä¹‰
   */
  header?: ReactNode | string;
  /**
   * å¯¹åº” activeKeyï¼Œå½“å‰é¢æ¿ç»„ä»¶çš„çš„å”¯ä¸€æ ‡è¯†
   */
  name: string;
}

const Item: FC<PropsWithChildren<Props>> = ({ children, header, name }) => {
  const { activeKeys, onToggle } = useCollapseStickyContext();
  const [loading, setLoading] = useState(false);
  const isExpanded = useMemo(
    () =>
      isArray(activeKeys)
        ? activeKeys?.indexOf(name) > -1
        : activeKeys === name,
    [activeKeys, name]
  );

  const handleClick = (e: React.MouseEvent<Element, MouseEvent>) => {
    onToggle(name, e).finally(() => {});
  };

  return (
    <ul className={cs(!isExpanded ? css.hidden : "")}>
      <li
        className={cs(isExpanded ? css.sticky : "")}
        onClick={handleClick}
        data-expand-name={`${Number(isExpanded)}_${name}`}
      >
        <i className={cs(css.icon, isExpanded ? css.active : "")} />
        {header}
      </li>
      {children || null}
    </ul>
  );
};

export default Item;
```

### ç”¨æ³•

åœ¨ä¸šåŠ¡å±‚é¢ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥è¿™ collapse-sticky çš„ç»„ä»¶ï¼Œç”±äº item ç»„ä»¶æœ¬èº«å°±åœ¨ collapse-sticky æš´éœ²ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–å¼•å…¥ item ç»„ä»¶ï¼Œåªéœ€è¦ç¤ºä¾‹åŒ–å‡ºæ¥å°±å¥½ã€‚

```tsx
<CollapseSticky activeKey={activeKey} onChange={handleChange}>
  {collapseList.map((item, index) => (
    <CollapseStickyItem key={item.id} header={item.title} name={`${index}`}>
      <li>1</li>
      <li>2</li>
      <li>3</li>
      <li>4</li>
    </CollapseStickyItem>
  ))}
</CollapseSticky>
```

### æ€è€ƒ

æœ€ç»ˆæˆ‘çš„ç‰ˆæœ¬å·²ç»å¤§è‡´è¾“å‡ºå®Œæˆï¼Œè€Œåœ¨é¢å¯¹ç»„é•¿çš„è¯„å®¡æ—¶ï¼Œä»–çš„åŸè¯æ˜¯ï¼Œä¸ºä»€ä¹ˆè¦æ–°å¢ä¸€ä¸ª context çš„æ¦‚å¿µï¼Œé¡¹ç›®ä¸­å·²ç»æœ‰ store å»ç®¡ç†è¿™ç§å…¨å±€çŠ¶æ€ï¼Œåˆæ–°å¢ä¸€ä¸ª contextï¼Œæ˜¯å¦ä¼šå¸¦æ¥ä¸€ä¸ªæ–°çš„åé‡çš„ä¸œè¥¿ï¼Œåˆ°æ—¶å€™å¦‚æœåˆ«äººçœ‹åˆ°è¿™ä¸ªï¼Œä¹Ÿéšä¾¿æ‹¿å»ç”¨ï¼Œæ€ä¹ˆåŠï¼Œè€Œä¸”è¿™ç§å†™æ³•ä¸Šï¼Œå¸¦æ¥ä¸€å®šçš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬è¿™ä¸ªé¡¹ç›®æ¯”è¾ƒç®€å•ï¼Œå°½é‡ä¸è¦ç”¨è¿™ä¹ˆå¤æ‚å»åšè¿™ç§äº‹æƒ…ï¼Œä¼šå¸¦æ¥å­¦ä¹ æˆæœ¬ï¼Œè¿˜ä¼šå¸¦æ¥æ–°çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œåˆ°æ—¶å€™ä¸å¥½ç®¡ç†ï¼Œåˆ°æ—¶å€™é¡¹ç›®é‡Œæ··ç”¨ store è·Ÿ context ä¹Ÿä¸å¥½æº¯æºã€‚
è€Œæˆ‘çš„å›ç­”æ˜¯ï¼š

- store è·Ÿ context çš„æ¦‚å¿µè¦åŒºåˆ†æ¸…æ¥šï¼Œæˆ‘çš„ç†è§£ä¸Šï¼Œstore æ˜¯ç®¡ç†é¡¹ç›®çš„å…¨å±€çŠ¶æ€ï¼Œç»„ä»¶çš„å±€éƒ¨å…¨å±€çŠ¶æ€æ˜¯å¹¶éå¾—ç”¨ storeï¼Œè€Œä¸”å…¬å…±ç»„ä»¶å¹¶ä¸ä¼šä½¿ç”¨ store è¿™ç§ç¬¬ä¸‰æ–¹ä¾èµ–åº“å»ç®¡ç†å…¨å±€çŠ¶æ€ï¼Œç”¨ context ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œè€Œä¸”å½“å‰è¿™ç§ç»„ä»¶å†™æ³•çš„åœºæ™¯ä¹Ÿåªèƒ½ç”¨ context
- headless ç»„ä»¶ä¼˜ç‚¹æœ¬æ¥å°±æ˜¯é«˜åº¦æ‹“å±•ï¼Œui æ ·å¼å¯ä»¥è‡ªç”±å®šåˆ¶ï¼Œè™½ç„¶ç›®å‰é¡¹ç›®å¹¶æ²¡æœ‰æ¥å…¥åŸå­ cssï¼Œå¹¶ä¸è¶³ä»¥æ‰“å¼€ headless çš„å…¨åŠŸèƒ½ï¼Œç¼ºç‚¹å°±æ˜¯å¯èƒ½éœ€è¦äºŒæ¬¡å°è£…ä¸€ä¸ªç»„ä»¶ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªä¸šåŠ¡ç»„ä»¶å»ä½¿ç”¨ï¼Œä½¿ç”¨ä¸Šè‚¯å®šæ˜¯ä¼šå¤æ‚äº›

è¿™ä¸ªé¡¹ç›®å¹¶ä¸æ˜¯æˆ‘çš„é¡¹ç›®ï¼Œæ‰€ä»¥ï¼Œè¿˜æ˜¯ä¼šå¬ä»ä¸Šé¢çš„å®‰æ’ï¼ŒæŠŠä»–å†™æˆä»–æœŸæœ›çš„æ ·å­ï¼Œä¸å†åˆ†å¼€ CollapseStickyItemï¼Œéƒ½æŠŠä»–èåˆäº†åœ¨ CollapseSticky é‡Œé¢ï¼Œä»–å¤§æ¦‚é•¿è¿™æ ·ï¼š

```tsx
<CollapseSticky
  activeKey={activeKey}
  onChange={handleChange}
  collapseList={data}
></CollapseSticky>
```

èµ·åˆè¿™ä¹ˆåšçš„åŸå› è¿˜æœ‰ä¸€ä¸ªæ˜¯ä¸ºäº†æ¨å¹¿ä¸€ä¸‹è¿™ç§å†™æ³•ï¼Œæ¯•ç«Ÿç›®å‰å¾ˆå¤šç»„ä»¶åº“éƒ½æ˜¯ä»¥è¿™ç§å½¢å¼å†™çš„ï¼Œheadless å¸¦æ¥çš„å¥½å¤„æ˜¯å·¨å¤§çš„ï¼Œæœªæ¥çš„äº‹æƒ…è°è¯´çš„å‡†å‘¢ï¼Œéœ€æ±‚æ°¸è¿œåœ¨æ”¹å˜ï¼Œè°åˆèƒ½çŸ¥é“æœªæ¥é¡¹ç›®å½¢æˆçš„æ¨¡æ ·ã€‚è¿˜æœ‰åƒé¡¹ç›®ä¸­æ»¥ç”¨ useCallbackï¼ŒuseEffect çš„ä¾èµ–é¡¹å…¨éƒ¨éƒ½æ˜¯ç”¨ eslint çš„ fix update ä¸€é”®æ›´æ–°ï¼Œå¯¼è‡´ä¾èµ–æ··ä¹±ï¼Œé‡æ¸²æŸ“çš„æ¬¡æ•°å‡ ä½•å€æ•°å¢é•¿ï¼Œç­‰ç­‰è¿™ç§é—®é¢˜ã€‚ä¹Ÿä¸çŸ¥é“å¤§å®¶å¦‚ä½•çœ‹å¾…è¿™ 2 ç§å†™æ³•ï¼Œåˆ°åº•å“ªä¸ªå¥½ï¼Œå“ªä¸ªåï¼Œæ¬¢è¿å¤§èƒ†è®¨è®º ğŸ˜„
